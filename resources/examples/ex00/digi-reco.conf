# - Configuration
# Authors:
#  - G. Olivi√©ro <goliviero@lpccaen.in2p3.fr>

#@description SuperNEMO Digi pipeline test
#@key_label  "name"
#@meta_label "type"


#####################################################################
# - Basic section
[name="flreconstruct" type="flreconstruct::section"]
#@config Basic setup

#@description Reconstruction version (extracted from input metadata)
experimentalSetupUrn : string = "urn:snemo:demonstrator:setup:1.0"

# #@description Number of events to reconstruct (0 = no limit)
# numberOfEvents : integer = 0


#####################################################################
# - Services section
[name="flreconstruct.services" type="flreconstruct::section"]
#@config Services setup

# #@description Service manager configuration URN (automatic)
# configUrn : string = "urn:snemo:demonstrator:setup:1.0:services"

#@description Service manager configuration file (manual)
config : string as path = "service_manager.conf"


#####################################################################
# - Plugin load section

[name="flreconstruct.plugins" type="flreconstruct::section"]
#@config Plugin managment

#@description The list of plugins
plugins : string[1] = "Falaise_Digitization"

# WARNING : PATH TO CHANGE (user path)
#Falaise_Digitization.directory : string = "/home/goliviero/software/Falaise/Digi_module/Digi_SNFR/_install.d/lib/Falaise/modules"


#####################################################################
# Must define "pipeline" as this is the module flreconstruct will use
# Define the main chain of modules in the pipeline:
# 1. Mock digitize and mock calibrate
# 2. CAT clusterization of tracker hits
# 3. TrackFit-ting tracker cluster hits
# 4. Reconstruct charged particle tracks
[name="pipeline" type="dpp::chain_module"]
#@config The main pipeline

#@description The list of processing modules chained along the pipeline
modules : string[1] = "Digitization"


####################################################################
# Here is the digitization module which convert SSD into SDD
[name="Digitization" type="snemo::digitization::digitization_module"]

#@description Verbosity
logging.priority : string = "debug"

#@parameter The label of the input "SD" bank
SD_label : string = "SD"

#@parameter The label of the output "SSD" bank
SSD_label : string = "SSD"

#@parameter The label of the database service
Db_label : string = "Db"

#@parameter The label of the geometry service
Geo_label : string = "geometry"

#@parameter The list of drivers
driver : string[1] = "digitization"

# The type identifiers of the signal drivers:
driver.digitization.type_id    : string = "snemo::digitization::digitization_driver"

# Configuration parameters for the Digitizaion driver:
driver.digitization.config.logging.priority : string = "debug"
driver.digitization.config.prng_seed : integer = 314159

# Configuration parameters for the electronic mapping:
driver.digitization.config.electronic_mapping.config.module_number   : integer = 0
driver.digitization.config.electronic_mapping.config.feast_channel_mapping : string as path integer = \
"@fldigi:config/snemo/demonstrator/simulation/digitization/0.1/feast_channel_mapping.csv"

# Configuration parameters for the calo signal shape builder:
driver.digitization.config.calo_ssb.logging_priority : string = "debug"
driver.digitization.config.calo_ssb.type_id   : string = "mctools::signal::signal_shape_builder"
driver.digitization.config.calo_ssb.config.category  : string  = "sigcalo"
driver.digitization.config.calo_ssb.config.registered_shapes : string[2] = \
"mctools::signal::triangle_signal_shape" \
"mctools::signal::multi_signal_shape"

# Configuration parameters for the gg signal shape builder:
driver.digitization.config.gg_ssb.logging_priority : string = "debug"
driver.digitization.config.gg_ssb.type_id          : string = "mctools::signal::signal_shape_builder"
driver.digitization.config.gg_ssb.config.category  : string  = "sigtracker"
driver.digitization.config.gg_ssb.config.registered_shapes : string[3] = \
"mctools::signal::triangle_signal_shape" \
"mctools::signal::triangle_gate_signal_shape" \
"mctools::signal::multi_signal_shape"

# Configuration parameters for the Geiger signal to TP algo:
driver.digitization.config.tracker_feb.config.signal_category : string = "sigtracker"
driver.digitization.config.tracker_feb.config.VLNT : real as electric_potential = -0.02 V
driver.digitization.config.tracker_feb.config.VHNT : real as electric_potential = -0.11 V
driver.digitization.config.tracker_feb.config.VHPT : real as electric_potential = 0.11 V
driver.digitization.config.tracker_feb.config.VCPT : real as electric_potential = 0.002 V

# Configuration parameters for the Calo signal to TP algo:
driver.digitization.config.calo_feb.config.signal_category    : string = "sigcalo"
driver.digitization.config.calo_feb.config.external_trigger   : boolean = false
driver.digitization.config.calo_feb.config.calo_tp_spare      : boolean = false
driver.digitization.config.calo_feb.config.low_threshold      : real as electric_potential = -0.01 V
driver.digitization.config.calo_feb.config.high_threshold     : real as electric_potential = -0.02 V
driver.digitization.config.calo_feb.config.sampling_frequency : string = "SNEMO_DEFAULT_CALO_FEB_FREQUENCY" #Interpreted as 2.56 GHz.
driver.digitization.config.calo_feb.config.timestamping_frequency    : string = "SNEMO_DEFAULT_CALO_FEB_TIMESTAMPING_FREQUENCY" #Interpreted as 160 MHz. (6,25ns)
driver.digitization.config.calo_feb.config.readout_post_trig_window  : real as time = 300 ns
driver.digitization.config.calo_feb.config.acquisition_window_length : integer = 1024 # in samples


# Configuration parameters for the Trigger algo:

#@description Files that list files describing the trigger system
driver.digitization.config.trigger_filename : string as path = \
"@fldigi:config/snemo/demonstrator/simulation/digitization/0.1/trigger_parameters.conf"

# end
